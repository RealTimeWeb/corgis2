

var covid_INDEXES = [
    ["(None)", "(None)"],
    
    ["Location.Country", "Location.Country"] ,
    ["Location.Code", "Location.Code"] 
];

var covid_INDEX_VALUES = {
    "(None)": [],
    
    "Location.Country": [
        
        ["Afghanistan", "Afghanistan"] ,
        ["Albania", "Albania"] ,
        ["Algeria", "Algeria"] ,
        ["Andorra", "Andorra"] ,
        ["Angola", "Angola"] ,
        ["Anguilla", "Anguilla"] ,
        ["Antigua_and_Barbuda", "Antigua_and_Barbuda"] ,
        ["Argentina", "Argentina"] ,
        ["Armenia", "Armenia"] ,
        ["Aruba", "Aruba"] ,
        ["Australia", "Australia"] ,
        ["Austria", "Austria"] ,
        ["Azerbaijan", "Azerbaijan"] ,
        ["Bahamas", "Bahamas"] ,
        ["Bahrain", "Bahrain"] ,
        ["Bangladesh", "Bangladesh"] ,
        ["Barbados", "Barbados"] ,
        ["Belarus", "Belarus"] ,
        ["Belgium", "Belgium"] ,
        ["Belize", "Belize"] ,
        ["Benin", "Benin"] ,
        ["Bermuda", "Bermuda"] ,
        ["Bhutan", "Bhutan"] ,
        ["Bolivia", "Bolivia"] ,
        ["Bonaire, Saint Eustatius and Saba", "Bonaire, Saint Eustatius and Saba"] ,
        ["Bosnia_and_Herzegovina", "Bosnia_and_Herzegovina"] ,
        ["Botswana", "Botswana"] ,
        ["Brazil", "Brazil"] ,
        ["British_Virgin_Islands", "British_Virgin_Islands"] ,
        ["Brunei_Darussalam", "Brunei_Darussalam"] ,
        ["Bulgaria", "Bulgaria"] ,
        ["Burkina_Faso", "Burkina_Faso"] ,
        ["Burundi", "Burundi"] ,
        ["Cambodia", "Cambodia"] ,
        ["Cameroon", "Cameroon"] ,
        ["Canada", "Canada"] ,
        ["Cape_Verde", "Cape_Verde"] ,
        ["Cases_on_an_international_conveyance_Japan", "Cases_on_an_international_conveyance_Japan"] ,
        ["Cayman_Islands", "Cayman_Islands"] ,
        ["Central_African_Republic", "Central_African_Republic"] ,
        ["Chad", "Chad"] ,
        ["Chile", "Chile"] ,
        ["China", "China"] ,
        ["Colombia", "Colombia"] ,
        ["Comoros", "Comoros"] ,
        ["Congo", "Congo"] ,
        ["Costa_Rica", "Costa_Rica"] ,
        ["Cote_dIvoire", "Cote_dIvoire"] ,
        ["Croatia", "Croatia"] ,
        ["Cuba", "Cuba"] ,
        ["Curasao", "Curasao"] ,
        ["Cyprus", "Cyprus"] ,
        ["Czechia", "Czechia"] ,
        ["Democratic_Republic_of_the_Congo", "Democratic_Republic_of_the_Congo"] ,
        ["Denmark", "Denmark"] ,
        ["Djibouti", "Djibouti"] ,
        ["Dominica", "Dominica"] ,
        ["Dominican_Republic", "Dominican_Republic"] ,
        ["Ecuador", "Ecuador"] ,
        ["Egypt", "Egypt"] ,
        ["El_Salvador", "El_Salvador"] ,
        ["Equatorial_Guinea", "Equatorial_Guinea"] ,
        ["Eritrea", "Eritrea"] ,
        ["Estonia", "Estonia"] ,
        ["Eswatini", "Eswatini"] ,
        ["Ethiopia", "Ethiopia"] ,
        ["Falkland_Islands_(Malvinas)", "Falkland_Islands_(Malvinas)"] ,
        ["Faroe_Islands", "Faroe_Islands"] ,
        ["Fiji", "Fiji"] ,
        ["Finland", "Finland"] ,
        ["France", "France"] ,
        ["French_Polynesia", "French_Polynesia"] ,
        ["Gabon", "Gabon"] ,
        ["Gambia", "Gambia"] ,
        ["Georgia", "Georgia"] ,
        ["Germany", "Germany"] ,
        ["Ghana", "Ghana"] ,
        ["Gibraltar", "Gibraltar"] ,
        ["Greece", "Greece"] ,
        ["Greenland", "Greenland"] ,
        ["Grenada", "Grenada"] ,
        ["Guam", "Guam"] ,
        ["Guatemala", "Guatemala"] ,
        ["Guernsey", "Guernsey"] ,
        ["Guinea", "Guinea"] ,
        ["Guinea_Bissau", "Guinea_Bissau"] ,
        ["Guyana", "Guyana"] ,
        ["Haiti", "Haiti"] ,
        ["Holy_See", "Holy_See"] ,
        ["Honduras", "Honduras"] ,
        ["Hungary", "Hungary"] ,
        ["Iceland", "Iceland"] ,
        ["India", "India"] ,
        ["Indonesia", "Indonesia"] ,
        ["Iran", "Iran"] ,
        ["Iraq", "Iraq"] ,
        ["Ireland", "Ireland"] ,
        ["Isle_of_Man", "Isle_of_Man"] ,
        ["Israel", "Israel"] ,
        ["Italy", "Italy"] ,
        ["Jamaica", "Jamaica"] ,
        ["Japan", "Japan"] ,
        ["Jersey", "Jersey"] ,
        ["Jordan", "Jordan"] ,
        ["Kazakhstan", "Kazakhstan"] ,
        ["Kenya", "Kenya"] ,
        ["Kosovo", "Kosovo"] ,
        ["Kuwait", "Kuwait"] ,
        ["Kyrgyzstan", "Kyrgyzstan"] ,
        ["Laos", "Laos"] ,
        ["Latvia", "Latvia"] ,
        ["Lebanon", "Lebanon"] ,
        ["Lesotho", "Lesotho"] ,
        ["Liberia", "Liberia"] ,
        ["Libya", "Libya"] ,
        ["Liechtenstein", "Liechtenstein"] ,
        ["Lithuania", "Lithuania"] ,
        ["Luxembourg", "Luxembourg"] ,
        ["Madagascar", "Madagascar"] ,
        ["Malawi", "Malawi"] ,
        ["Malaysia", "Malaysia"] ,
        ["Maldives", "Maldives"] ,
        ["Mali", "Mali"] ,
        ["Malta", "Malta"] ,
        ["Marshall_Islands", "Marshall_Islands"] ,
        ["Mauritania", "Mauritania"] ,
        ["Mauritius", "Mauritius"] ,
        ["Mexico", "Mexico"] ,
        ["Moldova", "Moldova"] ,
        ["Monaco", "Monaco"] ,
        ["Mongolia", "Mongolia"] ,
        ["Montenegro", "Montenegro"] ,
        ["Montserrat", "Montserrat"] ,
        ["Morocco", "Morocco"] ,
        ["Mozambique", "Mozambique"] ,
        ["Myanmar", "Myanmar"] ,
        ["Namibia", "Namibia"] ,
        ["Nepal", "Nepal"] ,
        ["Netherlands", "Netherlands"] ,
        ["New_Caledonia", "New_Caledonia"] ,
        ["New_Zealand", "New_Zealand"] ,
        ["Nicaragua", "Nicaragua"] ,
        ["Niger", "Niger"] ,
        ["Nigeria", "Nigeria"] ,
        ["North_Macedonia", "North_Macedonia"] ,
        ["Northern_Mariana_Islands", "Northern_Mariana_Islands"] ,
        ["Norway", "Norway"] ,
        ["Oman", "Oman"] ,
        ["Pakistan", "Pakistan"] ,
        ["Palestine", "Palestine"] ,
        ["Panama", "Panama"] ,
        ["Papua_New_Guinea", "Papua_New_Guinea"] ,
        ["Paraguay", "Paraguay"] ,
        ["Peru", "Peru"] ,
        ["Philippines", "Philippines"] ,
        ["Poland", "Poland"] ,
        ["Portugal", "Portugal"] ,
        ["Puerto_Rico", "Puerto_Rico"] ,
        ["Qatar", "Qatar"] ,
        ["Romania", "Romania"] ,
        ["Russia", "Russia"] ,
        ["Rwanda", "Rwanda"] ,
        ["Saint_Kitts_and_Nevis", "Saint_Kitts_and_Nevis"] ,
        ["Saint_Lucia", "Saint_Lucia"] ,
        ["Saint_Vincent_and_the_Grenadines", "Saint_Vincent_and_the_Grenadines"] ,
        ["San_Marino", "San_Marino"] ,
        ["Sao_Tome_and_Principe", "Sao_Tome_and_Principe"] ,
        ["Saudi_Arabia", "Saudi_Arabia"] ,
        ["Senegal", "Senegal"] ,
        ["Serbia", "Serbia"] ,
        ["Seychelles", "Seychelles"] ,
        ["Sierra_Leone", "Sierra_Leone"] ,
        ["Singapore", "Singapore"] ,
        ["Sint_Maarten", "Sint_Maarten"] ,
        ["Slovakia", "Slovakia"] ,
        ["Slovenia", "Slovenia"] ,
        ["Solomon_Islands", "Solomon_Islands"] ,
        ["Somalia", "Somalia"] ,
        ["South_Africa", "South_Africa"] ,
        ["South_Korea", "South_Korea"] ,
        ["South_Sudan", "South_Sudan"] ,
        ["Spain", "Spain"] ,
        ["Sri_Lanka", "Sri_Lanka"] ,
        ["Sudan", "Sudan"] ,
        ["Suriname", "Suriname"] ,
        ["Sweden", "Sweden"] ,
        ["Switzerland", "Switzerland"] ,
        ["Syria", "Syria"] ,
        ["Taiwan", "Taiwan"] ,
        ["Tajikistan", "Tajikistan"] ,
        ["Thailand", "Thailand"] ,
        ["Timor_Leste", "Timor_Leste"] ,
        ["Togo", "Togo"] ,
        ["Trinidad_and_Tobago", "Trinidad_and_Tobago"] ,
        ["Tunisia", "Tunisia"] ,
        ["Turkey", "Turkey"] ,
        ["Turks_and_Caicos_islands", "Turks_and_Caicos_islands"] ,
        ["Uganda", "Uganda"] ,
        ["Ukraine", "Ukraine"] ,
        ["United_Arab_Emirates", "United_Arab_Emirates"] ,
        ["United_Kingdom", "United_Kingdom"] ,
        ["United_Republic_of_Tanzania", "United_Republic_of_Tanzania"] ,
        ["United_States_of_America", "United_States_of_America"] ,
        ["United_States_Virgin_Islands", "United_States_Virgin_Islands"] ,
        ["Uruguay", "Uruguay"] ,
        ["Uzbekistan", "Uzbekistan"] ,
        ["Venezuela", "Venezuela"] ,
        ["Vietnam", "Vietnam"] ,
        ["Wallis_and_Futuna", "Wallis_and_Futuna"] ,
        ["Western_Sahara", "Western_Sahara"] ,
        ["Yemen", "Yemen"] ,
        ["Zambia", "Zambia"] ,
        ["Zimbabwe", "Zimbabwe"] 
    ],
    "Location.Code": [
        
        ["", ""] ,
        ["ABW", "ABW"] ,
        ["AFG", "AFG"] ,
        ["AGO", "AGO"] ,
        ["AIA", "AIA"] ,
        ["ALB", "ALB"] ,
        ["AND", "AND"] ,
        ["ARE", "ARE"] ,
        ["ARG", "ARG"] ,
        ["ARM", "ARM"] ,
        ["ATG", "ATG"] ,
        ["AUS", "AUS"] ,
        ["AUT", "AUT"] ,
        ["AZE", "AZE"] ,
        ["BDI", "BDI"] ,
        ["BEL", "BEL"] ,
        ["BEN", "BEN"] ,
        ["BES", "BES"] ,
        ["BFA", "BFA"] ,
        ["BGD", "BGD"] ,
        ["BGR", "BGR"] ,
        ["BHR", "BHR"] ,
        ["BHS", "BHS"] ,
        ["BIH", "BIH"] ,
        ["BLR", "BLR"] ,
        ["BLZ", "BLZ"] ,
        ["BMU", "BMU"] ,
        ["BOL", "BOL"] ,
        ["BRA", "BRA"] ,
        ["BRB", "BRB"] ,
        ["BRN", "BRN"] ,
        ["BTN", "BTN"] ,
        ["BWA", "BWA"] ,
        ["CAF", "CAF"] ,
        ["CAN", "CAN"] ,
        ["CHE", "CHE"] ,
        ["CHL", "CHL"] ,
        ["CHN", "CHN"] ,
        ["CIV", "CIV"] ,
        ["CMR", "CMR"] ,
        ["CNG1925", "CNG1925"] ,
        ["COD", "COD"] ,
        ["COG", "COG"] ,
        ["COL", "COL"] ,
        ["COM", "COM"] ,
        ["CPV", "CPV"] ,
        ["CRI", "CRI"] ,
        ["CUB", "CUB"] ,
        ["CUW", "CUW"] ,
        ["CYM", "CYM"] ,
        ["CYP", "CYP"] ,
        ["CZE", "CZE"] ,
        ["DEU", "DEU"] ,
        ["DJI", "DJI"] ,
        ["DMA", "DMA"] ,
        ["DNK", "DNK"] ,
        ["DOM", "DOM"] ,
        ["DZA", "DZA"] ,
        ["ECU", "ECU"] ,
        ["EGY", "EGY"] ,
        ["ERI", "ERI"] ,
        ["ESH", "ESH"] ,
        ["ESP", "ESP"] ,
        ["EST", "EST"] ,
        ["ETH", "ETH"] ,
        ["FIN", "FIN"] ,
        ["FJI", "FJI"] ,
        ["FLK", "FLK"] ,
        ["FRA", "FRA"] ,
        ["FRO", "FRO"] ,
        ["GAB", "GAB"] ,
        ["GBR", "GBR"] ,
        ["GEO", "GEO"] ,
        ["GGY", "GGY"] ,
        ["GHA", "GHA"] ,
        ["GIB", "GIB"] ,
        ["GIN", "GIN"] ,
        ["GMB", "GMB"] ,
        ["GNB", "GNB"] ,
        ["GNQ", "GNQ"] ,
        ["GRC", "GRC"] ,
        ["GRD", "GRD"] ,
        ["GRL", "GRL"] ,
        ["GTM", "GTM"] ,
        ["GUM", "GUM"] ,
        ["GUY", "GUY"] ,
        ["HND", "HND"] ,
        ["HRV", "HRV"] ,
        ["HTI", "HTI"] ,
        ["HUN", "HUN"] ,
        ["IDN", "IDN"] ,
        ["IMN", "IMN"] ,
        ["IND", "IND"] ,
        ["IRL", "IRL"] ,
        ["IRN", "IRN"] ,
        ["IRQ", "IRQ"] ,
        ["ISL", "ISL"] ,
        ["ISR", "ISR"] ,
        ["ITA", "ITA"] ,
        ["JAM", "JAM"] ,
        ["JEY", "JEY"] ,
        ["JOR", "JOR"] ,
        ["JPN", "JPN"] ,
        ["KAZ", "KAZ"] ,
        ["KEN", "KEN"] ,
        ["KGZ", "KGZ"] ,
        ["KHM", "KHM"] ,
        ["KNA", "KNA"] ,
        ["KOR", "KOR"] ,
        ["KWT", "KWT"] ,
        ["LAO", "LAO"] ,
        ["LBN", "LBN"] ,
        ["LBR", "LBR"] ,
        ["LBY", "LBY"] ,
        ["LCA", "LCA"] ,
        ["LIE", "LIE"] ,
        ["LKA", "LKA"] ,
        ["LSO", "LSO"] ,
        ["LTU", "LTU"] ,
        ["LUX", "LUX"] ,
        ["LVA", "LVA"] ,
        ["MAR", "MAR"] ,
        ["MCO", "MCO"] ,
        ["MDA", "MDA"] ,
        ["MDG", "MDG"] ,
        ["MDV", "MDV"] ,
        ["MEX", "MEX"] ,
        ["MHL", "MHL"] ,
        ["MKD", "MKD"] ,
        ["MLI", "MLI"] ,
        ["MLT", "MLT"] ,
        ["MMR", "MMR"] ,
        ["MNE", "MNE"] ,
        ["MNG", "MNG"] ,
        ["MNP", "MNP"] ,
        ["MOZ", "MOZ"] ,
        ["MRT", "MRT"] ,
        ["MSF", "MSF"] ,
        ["MUS", "MUS"] ,
        ["MWI", "MWI"] ,
        ["MYS", "MYS"] ,
        ["NAM", "NAM"] ,
        ["NCL", "NCL"] ,
        ["NER", "NER"] ,
        ["NGA", "NGA"] ,
        ["NIC", "NIC"] ,
        ["NLD", "NLD"] ,
        ["NOR", "NOR"] ,
        ["NPL", "NPL"] ,
        ["NZL", "NZL"] ,
        ["OMN", "OMN"] ,
        ["PAK", "PAK"] ,
        ["PAN", "PAN"] ,
        ["PER", "PER"] ,
        ["PHL", "PHL"] ,
        ["PNG", "PNG"] ,
        ["POL", "POL"] ,
        ["PRI", "PRI"] ,
        ["PRT", "PRT"] ,
        ["PRY", "PRY"] ,
        ["PSE", "PSE"] ,
        ["PYF", "PYF"] ,
        ["QAT", "QAT"] ,
        ["ROU", "ROU"] ,
        ["RUS", "RUS"] ,
        ["RWA", "RWA"] ,
        ["SAU", "SAU"] ,
        ["SDN", "SDN"] ,
        ["SEN", "SEN"] ,
        ["SGP", "SGP"] ,
        ["SLB", "SLB"] ,
        ["SLE", "SLE"] ,
        ["SLV", "SLV"] ,
        ["SMR", "SMR"] ,
        ["SOM", "SOM"] ,
        ["SRB", "SRB"] ,
        ["SSD", "SSD"] ,
        ["STP", "STP"] ,
        ["SUR", "SUR"] ,
        ["SVK", "SVK"] ,
        ["SVN", "SVN"] ,
        ["SWE", "SWE"] ,
        ["SWZ", "SWZ"] ,
        ["SXM", "SXM"] ,
        ["SYC", "SYC"] ,
        ["SYR", "SYR"] ,
        ["TCA", "TCA"] ,
        ["TCD", "TCD"] ,
        ["TGO", "TGO"] ,
        ["THA", "THA"] ,
        ["TJK", "TJK"] ,
        ["TLS", "TLS"] ,
        ["TTO", "TTO"] ,
        ["TUN", "TUN"] ,
        ["TUR", "TUR"] ,
        ["TZA", "TZA"] ,
        ["UGA", "UGA"] ,
        ["UKR", "UKR"] ,
        ["URY", "URY"] ,
        ["USA", "USA"] ,
        ["UZB", "UZB"] ,
        ["VAT", "VAT"] ,
        ["VCT", "VCT"] ,
        ["VEN", "VEN"] ,
        ["VGB", "VGB"] ,
        ["VIR", "VIR"] ,
        ["VNM", "VNM"] ,
        ["XKX", "XKX"] ,
        ["YEM", "YEM"] ,
        ["ZAF", "ZAF"] ,
        ["ZMB", "ZMB"] ,
        ["ZWE", "ZWE"] 
    ]
}

var covid_PROPERTIES = [
    ["Date.Day", "Date.Day"] ,
    ["Date.Month", "Date.Month"] ,
    ["Date.Year", "Date.Year"] ,
    ["Data.Cases", "Data.Cases"] ,
    ["Data.Deaths", "Data.Deaths"] ,
    ["Location.Country", "Location.Country"] ,
    ["Location.Code", "Location.Code"] ,
    ["Data.Population", "Data.Population"] ,
    ["Location.Continent", "Location.Continent"] ,
    ["Data.Rate", "Data.Rate"] 
]

Blockly.Blocks['covid_get'] = {
  init: function() {
    this.setColour(45);
    this.appendDummyInput('MAIN')
        .appendField("covid.get")
        .appendField(new Blockly.FieldDropdown(covid_PROPERTIES), "PROPERTY");
    this.appendDummyInput('SECOND')
        .appendField("filter")
        .appendField(new Blockly.FieldDropdown(covid_INDEXES, function(option) {
                        this.getSourceBlock().updateShape_(option);
                    }), "INDEX")
    this.updateShape_("(None)");
    this.setInputsInline(false);
    this.setOutput(true, "Array");
    this.setTooltip('Returns a list of covid data.');
  },
  mutationToDom: function() {
    var container = document.createElement('mutation');
    container.setAttribute('index', this.getFieldValue('INDEX'));
    container.setAttribute('index_value', this.getFieldValue('INDEX_VALUE'));
    container.setAttribute('module', "covid")
    return container;
  },
  domToMutation: function(xmlElement) {
    var index = xmlElement.getAttribute('index');
    this.setFieldValue(index, 'INDEX');
    var index_value = xmlElement.getAttribute('index_value');
    this.updateShape_(index, index_value);
  },
  updateShape_: function(index, index_value) {
    var inputGroup = this.getInput('SECOND')
    var fieldExists = this.getField('INDEX_VALUE');
    if (fieldExists) {
        inputGroup.removeField('INDEX_VALUE');
    }
    try {
        if (index != undefined && index != '(None)') {
            inputGroup.appendField(new Blockly.FieldDropdown(covid_INDEX_VALUES[index]), 'INDEX_VALUE')
            if (index_value != undefined) {
                this.setFieldValue(index_value, 'INDEX_VALUE');
            } else {
                this.setFieldValue(covid_INDEX_VALUES[index][0][0], 'INDEX_VALUE');
            }
        }
    } catch (e) {
        inputGroup.appendField(new Blockly.FieldLabel("Reset to fix the blocks"));
        console.error(e);
    }
  }
};
Blockly.Python['covid_get'] = function(block) {
    Blockly.Python.definitions_['import_covid'] = 'import covid';
    var propertyValue = block.getFieldValue('PROPERTY') || '';
    var property = Blockly.Python.quote_(propertyValue);
    var index_unquoted = block.getFieldValue('INDEX');
    var index = Blockly.Python.quote_(index_unquoted || '');
    var index_value = "''";
    if (index_unquoted !== '(None)') {
        var iv = block.getFieldValue('INDEX_VALUE') || "";
        index_value = Blockly.Python.quote_(iv);
    }
    var code = 'covid.get('+property+',' +index+','+index_value+')';
    return [code, Blockly.Python.ORDER_ATOMIC];
};

BlockMirrorTextToBlocks.prototype.MODULE_FUNCTION_SIGNATURES['covid'] = {
    "get": {
        custom: function(node, parent) {
            if (!node.args || node.args.length < 3 ||
                !node.args[0] || !node.args[1] || !node.args[2] ||
                node.args[0]._astname !== "Str" || node.args[1]._astname !== "Str" || node.args[2]._astname !== "Str"
            ) {
                throw new Error("Not the right function call.");
            }
            return BlockMirrorTextToBlocks.create_block("covid_get", null,
                {"PROPERTY": node.args[0].s.v},
                {}, {}, {"@INDEX": node.args[1].s.v,
                    "@INDEX_VALUE": node.args[2].s.v});
        }
    },
};

BlockMirrorBlockEditor.EXTRA_TOOLS['Data - covid'] = '<category name="Data - Covid" colour="45">'+
                    '<block type="covid_get"><mutation index="(None)" index_value=""></mutation></block>'+
                '</category>';