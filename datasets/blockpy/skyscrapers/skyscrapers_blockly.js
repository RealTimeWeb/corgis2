

var skyscrapers_INDEXES = [
    ["(None)", "(None)"],
    
    ["material", "material"] ,
    ["location.city", "location.city"] 
];

var skyscrapers_INDEX_VALUES = {
    "(None)": [],
    
    "material": [
        
        ["composite", "composite"] ,
        ["concrete", "concrete"] ,
        ["concrete/steel", "concrete/steel"] ,
        ["masonry", "masonry"] ,
        ["precast", "precast"] ,
        ["steel", "steel"] ,
        ["steel/concrete", "steel/concrete"] 
    ],
    "location.city": [
        
        ["", ""] ,
        ["Agawam", "Agawam"] ,
        ["Akron", "Akron"] ,
        ["Albany", "Albany"] ,
        ["Alexandria (VA)", "Alexandria (VA)"] ,
        ["Anchorage", "Anchorage"] ,
        ["Arlington", "Arlington"] ,
        ["Asheville", "Asheville"] ,
        ["Atlanta", "Atlanta"] ,
        ["Atlantic City", "Atlantic City"] ,
        ["Austin", "Austin"] ,
        ["Aventura", "Aventura"] ,
        ["Baltimore", "Baltimore"] ,
        ["Bartlesville", "Bartlesville"] ,
        ["Baton Rouge", "Baton Rouge"] ,
        ["Bellevue", "Bellevue"] ,
        ["Bethesda", "Bethesda"] ,
        ["Bethlehem", "Bethlehem"] ,
        ["Billings", "Billings"] ,
        ["Biloxi", "Biloxi"] ,
        ["Binghamton", "Binghamton"] ,
        ["Birmingham (AL)", "Birmingham (AL)"] ,
        ["Bismarck", "Bismarck"] ,
        ["Bloomington", "Bloomington"] ,
        ["Boca Raton", "Boca Raton"] ,
        ["Boise", "Boise"] ,
        ["Boston", "Boston"] ,
        ["Bristol (CT)", "Bristol (CT)"] ,
        ["Buffalo", "Buffalo"] ,
        ["Burbank", "Burbank"] ,
        ["Cambridge", "Cambridge"] ,
        ["Camden", "Camden"] ,
        ["Cape Canaveral", "Cape Canaveral"] ,
        ["Charleston", "Charleston"] ,
        ["Charlotte", "Charlotte"] ,
        ["Chicago", "Chicago"] ,
        ["Cincinnati", "Cincinnati"] ,
        ["Clayton", "Clayton"] ,
        ["Cleveland", "Cleveland"] ,
        ["Columbus", "Columbus"] ,
        ["Covington", "Covington"] ,
        ["Dallas", "Dallas"] ,
        ["Dayton", "Dayton"] ,
        ["Denver", "Denver"] ,
        ["Des Moines", "Des Moines"] ,
        ["Detroit", "Detroit"] ,
        ["East Chicago", "East Chicago"] ,
        ["El Paso", "El Paso"] ,
        ["Evanston", "Evanston"] ,
        ["Fargo", "Fargo"] ,
        ["Fort Lauderdale", "Fort Lauderdale"] ,
        ["Fort Lee", "Fort Lee"] ,
        ["Fort Myers", "Fort Myers"] ,
        ["Fort Wayne", "Fort Wayne"] ,
        ["Fort Worth", "Fort Worth"] ,
        ["Galveston", "Galveston"] ,
        ["Gary", "Gary"] ,
        ["Glendale", "Glendale"] ,
        ["Grand Rapids", "Grand Rapids"] ,
        ["Guttenberg", "Guttenberg"] ,
        ["Hallandale Beach", "Hallandale Beach"] ,
        ["Harrisburg", "Harrisburg"] ,
        ["Hartford", "Hartford"] ,
        ["Hoboken", "Hoboken"] ,
        ["Hollywood", "Hollywood"] ,
        ["Honolulu", "Honolulu"] ,
        ["Houston", "Houston"] ,
        ["Indianapolis", "Indianapolis"] ,
        ["Itasca", "Itasca"] ,
        ["Jacksonville", "Jacksonville"] ,
        ["Jersey City", "Jersey City"] ,
        ["Joliet", "Joliet"] ,
        ["Kansas City", "Kansas City"] ,
        ["La Porte", "La Porte"] ,
        ["Lansing", "Lansing"] ,
        ["Las Vegas", "Las Vegas"] ,
        ["Lexington", "Lexington"] ,
        ["Lincoln (NE)", "Lincoln (NE)"] ,
        ["Long Beach", "Long Beach"] ,
        ["Los Angeles", "Los Angeles"] ,
        ["Louisville", "Louisville"] ,
        ["Lubbock", "Lubbock"] ,
        ["Manchester (NH)", "Manchester (NH)"] ,
        ["Marco Island", "Marco Island"] ,
        ["McAllen", "McAllen"] ,
        ["Memphis", "Memphis"] ,
        ["Meridian", "Meridian"] ,
        ["Miami", "Miami"] ,
        ["Miami Beach", "Miami Beach"] ,
        ["Michigan City", "Michigan City"] ,
        ["Midland", "Midland"] ,
        ["Milwaukee", "Milwaukee"] ,
        ["Minneapolis", "Minneapolis"] ,
        ["Mobile", "Mobile"] ,
        ["Montville", "Montville"] ,
        ["Nashville", "Nashville"] ,
        ["New Brunswick", "New Brunswick"] ,
        ["New Haven", "New Haven"] ,
        ["New Orleans", "New Orleans"] ,
        ["New Rochelle", "New Rochelle"] ,
        ["New York City", "New York City"] ,
        ["Newark", "Newark"] ,
        ["Newport", "Newport"] ,
        ["Norfolk", "Norfolk"] ,
        ["North Miami Beach", "North Miami Beach"] ,
        ["Oak Park", "Oak Park"] ,
        ["Oakbrook", "Oakbrook"] ,
        ["Oakland", "Oakland"] ,
        ["Oklahoma City", "Oklahoma City"] ,
        ["Omaha", "Omaha"] ,
        ["Orange Beach", "Orange Beach"] ,
        ["Orlando", "Orlando"] ,
        ["Pearl City (Oahu)", "Pearl City (Oahu)"] ,
        ["Peoria", "Peoria"] ,
        ["Philadelphia", "Philadelphia"] ,
        ["Phoenix", "Phoenix"] ,
        ["Pittsburgh", "Pittsburgh"] ,
        ["Portland", "Portland"] ,
        ["Portland (ME)", "Portland (ME)"] ,
        ["Portsmouth (RI)", "Portsmouth (RI)"] ,
        ["Providence", "Providence"] ,
        ["Raleigh", "Raleigh"] ,
        ["Reno", "Reno"] ,
        ["Richmond", "Richmond"] ,
        ["Riviera Beach", "Riviera Beach"] ,
        ["Roanoke", "Roanoke"] ,
        ["Rochester", "Rochester"] ,
        ["Royal Oak", "Royal Oak"] ,
        ["Sacramento", "Sacramento"] ,
        ["Salt Lake City", "Salt Lake City"] ,
        ["San Antonio", "San Antonio"] ,
        ["San Diego", "San Diego"] ,
        ["San Francisco", "San Francisco"] ,
        ["Seattle", "Seattle"] ,
        ["Shorewood", "Shorewood"] ,
        ["Silver Spring", "Silver Spring"] ,
        ["South Padre Island", "South Padre Island"] ,
        ["Southfield", "Southfield"] ,
        ["Springfield (MA)", "Springfield (MA)"] ,
        ["St. Louis", "St. Louis"] ,
        ["St. Paul", "St. Paul"] ,
        ["St. Petersburg (FL)", "St. Petersburg (FL)"] ,
        ["Sunny Isles Beach", "Sunny Isles Beach"] ,
        ["Syracuse", "Syracuse"] ,
        ["Tacoma", "Tacoma"] ,
        ["Tallahassee", "Tallahassee"] ,
        ["Tampa", "Tampa"] ,
        ["Tempe", "Tempe"] ,
        ["Toledo", "Toledo"] ,
        ["Tucson", "Tucson"] ,
        ["Tulsa", "Tulsa"] ,
        ["Ventnor City", "Ventnor City"] ,
        ["Virginia Beach", "Virginia Beach"] ,
        ["Waco", "Waco"] ,
        ["Washington D.C.", "Washington D.C."] ,
        ["West Palm Beach", "West Palm Beach"] ,
        ["West Sacramento", "West Sacramento"] ,
        ["White Plains", "White Plains"] ,
        ["Wilmington", "Wilmington"] ,
        ["Winston-Salem", "Winston-Salem"] ,
        ["Worcester", "Worcester"] 
    ]
}

var skyscrapers_PROPERTIES = [
    ["id", "id"] ,
    ["material", "material"] ,
    ["name", "name"] ,
    ["location.city", "location.city"] ,
    ["location.city_id", "location.city_id"] ,
    ["location.country", "location.country"] ,
    ["location.country id", "location.country id"] ,
    ["location.latitude", "location.latitude"] ,
    ["location.longitude", "location.longitude"] ,
    ["purposes.abandoned", "purposes.abandoned"] ,
    ["purposes.air traffic control tower", "purposes.air traffic control tower"] ,
    ["purposes.belltower", "purposes.belltower"] ,
    ["purposes.bridge", "purposes.bridge"] ,
    ["purposes.casino", "purposes.casino"] ,
    ["purposes.commercial", "purposes.commercial"] ,
    ["purposes.education", "purposes.education"] ,
    ["purposes.exhibition", "purposes.exhibition"] ,
    ["purposes.government", "purposes.government"] ,
    ["purposes.hospital", "purposes.hospital"] ,
    ["purposes.hotel", "purposes.hotel"] ,
    ["purposes.industrial", "purposes.industrial"] ,
    ["purposes.library", "purposes.library"] ,
    ["purposes.multiple", "purposes.multiple"] ,
    ["purposes.museum", "purposes.museum"] ,
    ["purposes.observation", "purposes.observation"] ,
    ["purposes.office", "purposes.office"] ,
    ["purposes.other", "purposes.other"] ,
    ["purposes.religious", "purposes.religious"] ,
    ["purposes.residential", "purposes.residential"] ,
    ["purposes.retail", "purposes.retail"] ,
    ["purposes.serviced apartments", "purposes.serviced apartments"] ,
    ["purposes.telecommunications", "purposes.telecommunications"] ,
    ["statistics.floors above", "statistics.floors above"] ,
    ["statistics.height", "statistics.height"] ,
    ["statistics.number of purposes", "statistics.number of purposes"] ,
    ["statistics.rank", "statistics.rank"] ,
    ["status.current", "status.current"] ,
    ["status.completed.is completed", "status.completed.is completed"] ,
    ["status.completed.year", "status.completed.year"] ,
    ["status.started.is started", "status.started.is started"] ,
    ["status.started.year", "status.started.year"] 
]

Blockly.Blocks['skyscrapers_get'] = {
  init: function() {
    this.setColour(45);
    this.appendDummyInput('MAIN')
        .appendField("skyscrapers.get")
        .appendField(new Blockly.FieldDropdown(skyscrapers_PROPERTIES), "PROPERTY");
    this.appendDummyInput('SECOND')
        .appendField("filter")
        .appendField(new Blockly.FieldDropdown(skyscrapers_INDEXES, function(option) {
                        this.getSourceBlock().updateShape_(option);
                    }), "INDEX")
    this.updateShape_("(None)");
    this.setInputsInline(false);
    this.setOutput(true, "Array");
    this.setTooltip('Returns a list of skyscrapers data.');
  },
  mutationToDom: function() {
    var container = document.createElement('mutation');
    container.setAttribute('index', this.getFieldValue('INDEX'));
    container.setAttribute('index_value', this.getFieldValue('INDEX_VALUE'));
    container.setAttribute('module', "skyscrapers")
    return container;
  },
  domToMutation: function(xmlElement) {
    var index = xmlElement.getAttribute('index');
    this.setFieldValue(index, 'INDEX');
    var index_value = xmlElement.getAttribute('index_value');
    this.updateShape_(index, index_value);
  },
  updateShape_: function(index, index_value) {
    var inputGroup = this.getInput('SECOND')
    var fieldExists = this.getField('INDEX_VALUE');
    if (fieldExists) {
        inputGroup.removeField('INDEX_VALUE');
    }
    try {
        if (index != undefined && index != '(None)') {
            inputGroup.appendField(new Blockly.FieldDropdown(skyscrapers_INDEX_VALUES[index]), 'INDEX_VALUE')
            if (index_value != undefined) {
                this.setFieldValue(index_value, 'INDEX_VALUE');
            } else {
                this.setFieldValue(skyscrapers_INDEX_VALUES[index][0][0], 'INDEX_VALUE');
            }
        }
    } catch (e) {
        inputGroup.appendField(new Blockly.FieldLabel("Reset to fix the blocks"));
        console.error(e);
    }
  }
};
Blockly.Python['skyscrapers_get'] = function(block) {
    Blockly.Python.definitions_['import_skyscrapers'] = 'import skyscrapers';
    var propertyValue = block.getFieldValue('PROPERTY') || '';
    var property = Blockly.Python.quote_(propertyValue);
    var index_unquoted = block.getFieldValue('INDEX');
    var index = Blockly.Python.quote_(index_unquoted || '');
    var index_value = "''";
    if (index_unquoted !== '(None)') {
        var iv = block.getFieldValue('INDEX_VALUE') || "";
        index_value = Blockly.Python.quote_(iv);
    }
    var code = 'skyscrapers.get('+property+',' +index+','+index_value+')';
    return [code, Blockly.Python.ORDER_ATOMIC];
};

BlockMirrorTextToBlocks.prototype.MODULE_FUNCTION_SIGNATURES['skyscrapers'] = {
    "get": {
        custom: function(node, parent) {
            if (!node.args || node.args.length < 3 ||
                !node.args[0] || !node.args[1] || !node.args[2] ||
                node.args[0]._astname !== "Str" || node.args[1]._astname !== "Str" || node.args[2]._astname !== "Str"
            ) {
                throw new Error("Not the right function call.");
            }
            return BlockMirrorTextToBlocks.create_block("skyscrapers_get", null,
                {"PROPERTY": node.args[0].s.v},
                {}, {}, {"@INDEX": node.args[1].s.v,
                    "@INDEX_VALUE": node.args[2].s.v});
        }
    },
};

BlockMirrorBlockEditor.EXTRA_TOOLS['Data - skyscrapers'] = '<category name="Data - Skyscrapers" colour="45">'+
                    '<block type="skyscrapers_get"><mutation index="(None)" index_value=""></mutation></block>'+
                '</category>';